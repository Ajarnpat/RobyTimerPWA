<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roby Timer and Notes</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f4f8fb">
  <style>
    html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: Arial, sans-serif; background-color: #f4f8fb; }
    .container { display: grid; grid-template-columns: 1fr 2fr; width: 66%; height: 100%; margin: 0 auto; }
    .side-col { display: flex; flex-direction: column; justify-content: space-between; padding: 10px; box-sizing: border-box; }
    .left-col textarea { width: 100%; border: none; outline: none; background: transparent; resize: none; overflow: hidden; font-size: 2.625em; line-height: 1.2em; }
    .center-col { display: flex; flex-direction: column; align-items: center; padding: 10px; box-sizing: border-box; overflow: hidden; }
    .overall-title { background-color: yellow; padding: 5px; font-size: 1.5em; font-weight: bold; margin-bottom: 10px; width: 100%; text-align: center; border: none; outline: none; }
    .panel { background-color: yellow; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); padding: 9px; margin: 5px; width: 100%; max-width: 500px; text-align: center; transition: background-color 0.5s ease; }
    .clock { background-color: #e0f7fa; color: #006064; margin-bottom: 10px; }
    .time-display { font-size: 2em; margin: 5px 0; }
    input[type=number], .title-input { width: 50px; padding: 4px; font-size: 0.9em; margin: 2px; }
    .controls button { margin: 2px; padding: 4px 8px; font-size: 0.85em; }
    .global-controls { margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="side-col left-col">
      <textarea rows="3" placeholder="Note 1"></textarea>
      <textarea rows="3" placeholder="Note 2"></textarea>
      <textarea rows="3" placeholder="Note 3"></textarea>
      <textarea rows="3" placeholder="Note 4"></textarea>
      <textarea rows="3" placeholder="Note 5"></textarea>
    </div>
    <div class="center-col">
      <input class="overall-title" id="mainTitle" type="text" value="Robyâ€™s Test Timer">
      <div class="panel clock">
        <h2>Current Time</h2>
        <div class="time-display" id="currentTime">--:--:--</div>
      </div>
      <div class="panel" id="panel1">
        <input class="title-input" id="title1" value="Timer 1">
        <div class="time-display" id="display1">00:00:00</div>
        <input type="number" id="h1" placeholder="HH">
        <input type="number" id="m1" placeholder="MM">
        <input type="number" id="s1" placeholder="SS">
        <div class="controls">
          <button id="start1" onclick="startTimer(1)">Start</button>
          <button id="toggle1" onclick="toggleTimer(1)">Pause</button>
          <button onclick="resetTimer(1)">Reset</button>
        </div>
      </div>
      <div class="panel" id="panel2">
        <input class="title-input" id="title2" value="Timer 2">
        <div class="time-display" id="display2">00:00:00</div>
        <input type="number" id="h2" placeholder="HH">
        <input type="number" id="m2" placeholder="MM">
        <input type="number" id="s2" placeholder="SS">
        <div class="controls">
          <button id="start2" onclick="startTimer(2)">Start</button>
          <button id="toggle2" onclick="toggleTimer(2)">Pause</button>
          <button onclick="resetTimer(2)">Reset</button>
        </div>
      </div>
      <div class="panel" id="panel3">
        <input class="title-input" id="title3" value="Timer 3">
        <div class="time-display" id="display3">00:00:00</div>
        <input type="number" id="h3" placeholder="HH">
        <input type="number" id="m3" placeholder="MM">
        <input type="number" id="s3" placeholder="SS">
        <div class="controls">
          <button id="start3" onclick="startTimer(3)">Start</button>
          <button id="toggle3" onclick="toggleTimer(3)">Pause</button>
          <button onclick="resetTimer(3)">Reset</button>
        </div>
      </div>
      <div class="panel global-controls">
        <label for="warning">Warning Time (min):</label>
        <input type="number" id="warning" placeholder="e.g. 1">
        <button onclick="startAllTimers()">Start All Timers</button>
      </div>
    </div>
  </div>

  <audio id="warningSound" preload>
    <source src="audio/warn.mp3" type="audio/mpeg">
    <source src="audio/warn.ogg" type="audio/ogg">
  </audio>
  <audio id="finalSound" preload>
    <source src="audio/end.mp3" type="audio/mpeg">
    <source src="audio/end.ogg" type="audio/ogg">
  </audio>

  <script>
    const timers = {};
    const remaining = {};
    const paused = {};

    window.addEventListener('load', () => {
      const warn = document.getElementById('warningSound');
      const fin = document.getElementById('finalSound');
      const unlock = () => { warn.play().then(()=>warn.pause()); fin.play().then(()=>fin.pause()); document.body.removeEventListener('click', unlock); };
      document.body.addEventListener('click', unlock);
    });

    function formatTime(sec) {
      const h = String(Math.floor(sec/3600)).padStart(2,'0');
      const m = String(Math.floor((sec%3600)/60)).padStart(2,'0');
      const s = String(sec%60).padStart(2,'0');
      return `${h}:${m}:${s}`;
    }

    function startTimer(n) {
      const h = parseInt(document.getElementById('h'+n).value)||0;
      const m = parseInt(document.getElementById('m'+n).value)||0;
      const s = parseInt(document.getElementById('s'+n).value)||0;
      remaining[n] = h*3600 + m*60 + s;
      if(remaining[n]<=0) return;
      paused[n] = false;
      document.getElementById('toggle'+n).textContent = 'Pause';
      runInterval(n);
    }

    function runInterval(n) {
      clearInterval(timers[n]);
      const thresh = (parseInt(document.getElementById('warning').value)||0)*60;
      timers[n] = setInterval(() => {
        if(paused[n]) return;
        remaining[n]--;
        document.getElementById('display'+n).textContent = formatTime(remaining[n]);
        const panel = document.getElementById('panel'+n);
        if(remaining[n] === thresh && thresh>0) {
          document.getElementById('warningSound').play().catch(()=>{});
          panel.style.backgroundColor = 'orange';
        }
        if(remaining[n] <= 0) {
          clearInterval(timers[n]);
          document.getElementById('display'+n).textContent = '00:00:00';
          document.getElementById('finalSound').play().catch(()=>{});
          panel.style.backgroundColor = 'red';
        }
      }, 1000);
    }

    function toggleTimer(n) {
      paused[n] = !paused[n];
      const btn = document.getElementById('toggle'+n);
      btn.textContent = paused[n] ? 'Resume' : 'Pause';
    }

    function resetTimer(n) {
      clearInterval(timers[n]);
      document.getElementById('display'+n).textContent = '00:00:00';
      document.getElementById('panel'+n).style.backgroundColor = 'yellow';
      paused[n] = true;
    }

    function startAllTimers() { startTimer(1); startTimer(2); startTimer(3); }

    function updateTime() { document.getElementById('currentTime').textContent = new Date().toLocaleTimeString(); }
    setInterval(updateTime,1000);
    updateTime();

    if('serviceWorker' in navigator) window.addEventListener('load', () => navigator.serviceWorker.register('service-worker.js'));
  </script>
</body>
</html>
